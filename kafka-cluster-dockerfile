# use an official Ubuntu base image
FROM ubuntu:20.04

# set environment variables to non-interactive (avoid prompts)
ENV DEBIAN_FRONTEND=noninteractive

# update package list and install required packages
RUN apt-get update && \
    apt-get install -y \
    docker.io \
    docker-compose \
    default-jre \
    openssh-server \
    python2 \
    python3

# create SSH directory
RUN mkdir /var/run/sshd

# create .ssh directory and copy the public key to authorized_keys
RUN mkdir -p /root/.ssh && \
    chmod 700 /root/.ssh

# copy the public key from the host to the container
COPY newkey.pub /root/.ssh/authorized_keys

# set permissions for the authorized_keys file
RUN chmod 600 /root/.ssh/authorized_keys

# expose SSH port
EXPOSE 22

# expose zookeeper and broker ports
EXPOSE 19091
EXPOSE 19092
EXPOSE 19093
EXPOSE 19094
EXPOSE 19095
EXPOSE 19096
EXPOSE 19097
EXPOSE 19098
EXPOSE 19099
EXPOSE 19100
EXPOSE 19101
EXPOSE 19102
EXPOSE 19103
EXPOSE 19104
EXPOSE 19105
EXPOSE 19106
EXPOSE 19107
EXPOSE 19108
EXPOSE 19109
EXPOSE 19110
EXPOSE 19111
EXPOSE 19112
EXPOSE 19113
EXPOSE 19114
EXPOSE 19115
EXPOSE 19116
EXPOSE 19117
EXPOSE 19118
EXPOSE 19119
EXPOSE 19120
EXPOSE 19121
EXPOSE 19122
EXPOSE 19123
EXPOSE 19124
EXPOSE 19125
EXPOSE 19126
EXPOSE 19127
EXPOSE 19128
EXPOSE 19129
EXPOSE 19130
EXPOSE 19131
EXPOSE 19132
EXPOSE 19133
EXPOSE 19134
EXPOSE 19135
EXPOSE 19136
EXPOSE 19137
EXPOSE 19138
EXPOSE 19139
EXPOSE 19140
EXPOSE 19141
EXPOSE 19142
EXPOSE 19143
EXPOSE 19144
EXPOSE 19145
EXPOSE 19146
EXPOSE 19147
EXPOSE 19148
EXPOSE 19149
EXPOSE 19150
EXPOSE 19151
EXPOSE 19152
EXPOSE 19153
EXPOSE 19154
EXPOSE 19155
EXPOSE 19156
EXPOSE 19157
EXPOSE 19158
EXPOSE 19159
EXPOSE 19160
EXPOSE 19161
EXPOSE 19162
EXPOSE 19163
EXPOSE 19164
EXPOSE 19165
EXPOSE 19166
EXPOSE 19167
EXPOSE 19168
EXPOSE 19169
EXPOSE 19170
EXPOSE 19171
EXPOSE 19172
EXPOSE 19173
EXPOSE 19174
EXPOSE 19175
EXPOSE 19176
EXPOSE 19177
EXPOSE 19178
EXPOSE 19179
EXPOSE 19180
EXPOSE 19181
EXPOSE 19182
EXPOSE 19183
EXPOSE 19184
EXPOSE 19185
EXPOSE 19186
EXPOSE 19187
EXPOSE 19188
EXPOSE 19189
EXPOSE 19190
EXPOSE 19191
EXPOSE 19192
EXPOSE 19193
EXPOSE 19194
EXPOSE 19195
EXPOSE 19196
EXPOSE 19197
EXPOSE 19198
EXPOSE 19199
EXPOSE 19200
EXPOSE 19201
EXPOSE 19202
EXPOSE 19203
EXPOSE 19204
EXPOSE 19205
EXPOSE 19206
EXPOSE 19207
EXPOSE 19208
EXPOSE 19209
EXPOSE 19210
EXPOSE 19211
EXPOSE 19212
EXPOSE 19213
EXPOSE 19214
EXPOSE 19215
EXPOSE 19216
EXPOSE 19217
EXPOSE 19218
EXPOSE 19219
EXPOSE 19220
EXPOSE 19221
EXPOSE 19222
EXPOSE 19223
EXPOSE 19224
EXPOSE 19225
EXPOSE 19226
EXPOSE 19227
EXPOSE 19228
EXPOSE 19229
EXPOSE 19230
EXPOSE 19231
EXPOSE 19232
EXPOSE 19233
EXPOSE 19234
EXPOSE 19235
EXPOSE 19236
EXPOSE 19237
EXPOSE 19238
EXPOSE 19239
EXPOSE 19240
EXPOSE 19241
EXPOSE 19242
EXPOSE 19243
EXPOSE 19244
EXPOSE 19245
EXPOSE 19246
EXPOSE 19247
EXPOSE 19248
EXPOSE 19249
EXPOSE 19250

# start SSH server and Docker daemon
CMD ["/bin/sh", "-c", "/usr/sbin/sshd -D & dockerd"]
